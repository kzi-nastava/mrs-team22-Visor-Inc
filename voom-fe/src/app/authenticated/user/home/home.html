<app-header></app-header>

<div class="p-8 rounded-3xl">
  <app-map
    [points]="routePoints()"
    (mapClick)="onMapClick($event)"
    (cleared)="onMapCleared()"
  ></app-map>
</div>

<section class="flex flex-col items-center w-full">
  <form
    class="flex max-w-[1200px] w-full ml-auto mr-auto justify-between items-center gap-6"
    [formGroup]="rideForm"
  >
    <app-value-input-string label="Pickup Location" formControlName="pickup">
    </app-value-input-string>

    <app-value-input-string label="Dropoff Location" formControlName="dropoff">
    </app-value-input-string>

    <app-dropdown [options]="vehicleOptions" [(selected)]="selectedVehicle"> </app-dropdown>
    <app-dropdown [options]="timeOptions" [(selected)]="selectedTime"> </app-dropdown>
  </form>

  <div class="w-full max-w-[1200px] mt-6">
    <h4 class="font-medium mb-2">Additional Pitstops</h4>
    <div class="flex gap-3 flex-wrap">
      @for (p of routePoints(); track p.id) { @if (p.type === 'STOP') {
      <div class="flex items-center gap-2 text-sm bg-gray-100 rounded-full px-3 py-1">
        <span class="text-red-500 text-xs">●</span>

        <span class="max-w-[200px] truncate">
          {{ p.address }}
        </span>

        <button
          type="button"
          class="ml-1 flex items-center justify-center w-5 h-5 rounded-full text-gray-500 hover:text-red-600 hover:bg-red-100 transition"
          (click)="removePoint(p.id)"
        >
          ✕
        </button>

        <button
          type="button"
          class="text-blue-600 text-xs hover:underline"
          (click)="setAsDropoff(p.id)"
        >
          Set as destination
        </button>
      </div>
      } }
    </div>
  </div>

  <p class="text-center text-lg py-8">Enter pickup, dropoff and type to see your estimate.</p>

  <button matButton="filled" class="px-10" [disabled]="!rideForm.valid" (click)="confirmRide()">
    Confirm Ride
  </button>
</section>

<app-footer></app-footer>
